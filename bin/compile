#!/bin/bash
BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

APP_DIR="/app"



OPENCV_VERSION=3.4.2
OPENCV_TGZ=opencv-$OPENCV_VERSION.tar.gz

TESSERACT_OCR_VERSION=4.0
TESSERACT_OCR_TGZ=tesseract-ocr-$TESSERACT_OCR_VERSION.tar.gz


cd $APP_DIR

echo "Downloading buildpack for opencv 3.4.2"
DOWNLOAD_URL="https://www.dropbox.com/s/brh3klgvv48g1sz/heroku18-buildpack-opencv3.4.2.tar.gz?dl=0"
curl -s -L $DOWNLOAD_URL > $APP_DIR/OPENCV_TGZ
tar -xvf $APP_DIR/OPENCV_TGZ -C $APP_DIR


echo "Building runtime environment"
mkdir -p $APP_DIR/.profile.d
cat <<EOF >$APP_DIR/.profile.d/opencv.sh
export LD_LIBRARY_PATH="\$HOME/.heroku/vendor/lib:\$LD_LIBRARY_PATH"
export PATH="\$HOME/.heroku/vendor/bin:\$PATH"
EOF

